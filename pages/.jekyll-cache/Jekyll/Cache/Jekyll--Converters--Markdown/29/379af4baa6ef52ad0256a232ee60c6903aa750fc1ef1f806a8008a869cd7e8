I"œ<p>CalyxOS is Android-based, and the usual procedure to build AOSP applies. If youâ€™re already familiar and setup to build Android, you can see the short version to get a quick idea. Otherwise, the long version goes into full detail to set it up from scratch.</p>

<h2 id="short-version">Short version</h2>
<ul>
  <li>This assumes you have an AOSP build environment already setup and have built it before</li>
</ul>

<p>Steps:</p>
<ol>
  <li>Initialize and sync the source code.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">repo init -u https://gitlab.com/CalyxOS/platform_manifest -b android11-qpr1</code></li>
      <li><code class="language-plaintext highlighter-rouge">repo sync</code></li>
    </ul>
  </li>
  <li>Obtain proprietary files for your device
    <ul>
      <li><code class="language-plaintext highlighter-rouge">./vendor/calyx/scripts/setup-apv.sh sunfish</code> (<code class="language-plaintext highlighter-rouge">sunfish</code> for Pixel 4a)</li>
    </ul>
  </li>
  <li>Build
    <ul>
      <li><code class="language-plaintext highlighter-rouge">source build/envsetup.sh</code></li>
      <li><code class="language-plaintext highlighter-rouge">lunch calyx_sunfish-user</code> (<code class="language-plaintext highlighter-rouge">sunfish</code> for Pixel 4a, <code class="language-plaintext highlighter-rouge">user</code> is used for release builds, you can use <code class="language-plaintext highlighter-rouge">userdebug</code> for development builds.)</li>
      <li><code class="language-plaintext highlighter-rouge">m</code></li>
    </ul>
  </li>
  <li>Install
    <ul>
      <li><code class="language-plaintext highlighter-rouge">fastboot flashall</code> (Run this in the same shell where you ran the build)</li>
    </ul>
  </li>
</ol>

<h2 id="long-version">Long version</h2>
<ul>
  <li>This will help you setup a build environment for CalyxOS from scratch</li>
</ul>

<h3 id="computer-setup"><a href="https://source.android.com/setup/build/initializing">Computer setup</a></h3>

<h4 id="os">OS</h4>
<ul>
  <li>Linux, specifcally Debian Stable is preferred and is used for official builds</li>
  <li>Other recent Linux distros (Arch, Ubuntu, Fedora amongst many others) should mostly work just fine</li>
  <li>Windows will work too, using WSL2 (Windows Subsystem for Linux)</li>
  <li>macOS isnâ€™t supported</li>
</ul>

<h4 id="hardware-requirements">Hardware requirements</h4>
<ul>
  <li>Android building is a very intensive process, and requires a lot of resources</li>
  <li>Approximately 250GB of free disk space (preferably on a fast SSD), more if you want to build for multiple devices</li>
  <li>At least 16GB of RAM, although 32GB or 64GB will give you a much better experience, especially if trying to use the computer while building</li>
  <li>A reasonably fast / unmetered internet connection, as the initial source code download is quite large (approximately 50GB)</li>
</ul>

<h4 id="install-packages">Install packages</h4>

<p>For Debian Stable and other Debian based distros:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">sudo apt update &amp;&amp; sudo apt install bc git curl zip m4 python3-protobuf default-jdk-headless default-jre-headless libncurses5 libncurses5-dev libssl-dev</code></li>
</ul>

<p>Other distributions may have the same or similar names for packages.</p>

<p>You may need to run the below command to prevent some warnings when building</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">sudo sysctl -w kernel.unprivileged_userns_clone 1</code></li>
</ul>

<h3 id="downloading-the-source-code">Downloading the source code</h3>

<h4 id="repo"><a href="https://source.android.com/setup/develop#installing-repo">repo</a></h4>
<p>repo is the tool used to download all the different CalyxOS (and AOSP) source code repositories</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir ~/bin
PATH=~/bin:$PATH
curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
chmod a+x ~/bin/repo
</code></pre></div></div>

<h4 id="calyxos">CalyxOS</h4>
<p>Now you can download the CalyxOS source code.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir ~/calyxos/android11-qpr1
cd ~/calyxos/android11-qpr1
repo init -u https://gitlab.com/CalyxOS/platform_manifest -b android11-qpr1
repo sync -j8 # You may use a higher number here if you have a fast computer and fast internet
</code></pre></div></div>

<p>This will be a big download and may take a long time. Once itâ€™s done, you can build CalyxOS</p>

<h5 id="proprietary-files">Proprietary files</h5>
<p>Phones need a lot of proprietary files to boot and for all hardware to work, we have automated scripts to download and set them up.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./vendor/calyx/scripts/setup-apv.sh sunfish # Replace sunfish (Pixel 4a) with your device codename here
</code></pre></div></div>

<h3 id="building">Building</h3>
<p>You made it this far! Now you can finally build CalyxOS</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source build/envsetup.sh
lunch calyx_sunfish-user # Replace sunfish (Pixel 4a) with your device codename here, and user with userdebug if you want a debug build
m # Yes, just the letter 'm'
</code></pre></div></div>

<p>This will be the longest step, it may take hours depending on your computer. Sit back and watch it build!</p>

<h3 id="installing">Installing</h3>
<ul>
  <li>You need to unlock your device. If you havenâ€™t done so already, you can run <code class="language-plaintext highlighter-rouge">fastboot flashing unlock</code> to unlock your device.</li>
  <li>After that, to install the freshly built images, run: <code class="language-plaintext highlighter-rouge">fastboot flashall</code> directly from the source code folder.</li>
</ul>

<p>Congrats! You just compiled and installed a build of CalyxOS on your device.</p>

<h2 id="components-built-outside-the-os">Components built outside the OS</h2>
<p>To keep the OS build simple and fast we build some components separately outside the AOSP build system, and copy them to a <code class="language-plaintext highlighter-rouge">prebuilts</code> repository so they donâ€™t need to be built every time the OS is built. A list of those with links to build instructions:</p>

<ul>
  <li><a href="kernel">Linux kernel</a></li>
  <li><a href="chromium">Chromium</a></li>
  <li><a href="microg">microG</a></li>
</ul>

<p>Additionally, we include some apps from F-Droid in the build process. These are the upstream binaries shipped as-is without any modifications.</p>

<h2 id="emulator">Emulator</h2>
<p>To build and run CalyxOS Emulator images, see <a href="emulator">Emulator</a></p>

<h2 id="releases">Releases</h2>

<p>The official [[production builds =&gt; get]] process is described under <a href="production">production</a></p>
:ET